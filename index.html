<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Designer Studio - Space Anomaly</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/3.4.3/gl-matrix-min.js"></script>
    <script src="https://unpkg.com/simplex-noise@3.0.1/simplex-noise.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.skypack.dev/three@0.136.0"
        }
      }
    </script>
</head>
<body>
    <!-- Shader Section -->
    <div class="shader-section">
        <canvas id="canvas"></canvas>
        <textarea id="codeEditor" class="editor" spellcheck="false" autocorrect="off" autocapitalize="off" translate="no" oninput="render()"></textarea>
        <pre id="error"></pre>
        <div id="indicator"></div>
        <div id="controls">
            <div class="controls">
                <input id="btnToggleView" class="icon" type="checkbox" name="toggleView" onclick="toggleView()">
                <input id="btnToggleResolution" class="icon" type="checkbox" name="toggleResolution" onchange="toggleResolution()">
                <input id="btnReset" class="icon" type="checkbox" name="reset" onclick="reset()">
            </div>
        </div>
    </div>

    <script type="x-shader/x-fragment">#version 300 es
/*********
* made by Matthias Hurrle (@atzedent)
*/
precision highp float;
out vec4 O;
uniform float time;
uniform vec2 resolution;
uniform vec2 move;
#define FC gl_FragCoord.xy
#define R resolution
#define T time
#define N normalize
#define S smoothstep
#define MN min(R.x,R.y)
#define rot(a) mat2(cos((a)-vec4(0,11,33,0)))
#define csqr(a) vec2(a.x*a.x-a.y*a.y,2.*a.x*a.y)
float rnd(vec3 p) {
    p=fract(p*vec3(12.9898,78.233,156.34));
    p+=dot(p,p+34.56);
    return fract(p.x*p.y*p.z);
}
float swirls(in vec3 p) {
    float d=.0;
    vec3 c=p;
    for(float i=min(.0,time); i<9.; i++) {
        p=.7*abs(p)/dot(p,p)-.7;
        p.yz=csqr(p.yz);
        p=p.zxy;
        d+=exp(-19.*abs(dot(p,c)));
    }
    return d;
}
vec3 march(in vec3 p, vec3 rd) {
    float d=.2, t=.0, c=.0, k=mix(.9,1.,rnd(rd)),
    maxd=length(p)-1.;
    vec3 col=vec3(0);
    for(float i=min(.0,time); i<120.; i++) {
        t+=d*exp(-2.*c)*k;
        c=swirls(p+rd*t);
        if (t<5e-2 || t>maxd) break;
        col+=vec3(c*c,c/1.05,c)*8e-3;
    }
    return col;
}
float rnd(vec2 p) {
    p=fract(p*vec2(12.9898,78.233));
    p+=dot(p,p+34.56);
    return fract(p.x*p.y);
}
vec3 sky(vec2 p, bool anim) {
    p.x-=.17-(anim?2e-4*T:.0);
    p*=500.;
    vec2 id=floor(p), gv=fract(p)-.5;
    float n=rnd(id), d=length(gv);
    if (n<.975) return vec3(0);
    return vec3(S(3e-2*n,1e-3*n,d*d));
}
void cam(inout vec3 p) {
    p.yz*=rot(move.y*6.3/MN-T*.05);
    p.xz*=rot(-move.x*6.3/MN+T*.025);
}
void main() {
    vec2 uv=(FC-.5*R)/MN;
    vec3 col=vec3(0),
    p=vec3(0,0,-16),
    rd=N(vec3(uv,1)), rdd=rd;
    cam(p); cam(rd);
    col=march(p,rd);
    col=S(-.2,.9,col);
    vec2 sn=.5+vec2(atan(rdd.x,rdd.z),atan(length(rdd.xz),rdd.y))/6.28318;
    col=max(col,vec3(sky(sn,true)+sky(2.+sn*2.,true)));
    float t=min((time-.5)*.3,1.);
    uv=FC/R*2.-1.;
    uv*=.7;
    float v=pow(dot(uv,uv),1.8);
    col=mix(col,vec3(0),v);
    col=mix(vec3(0),col,t);
    col=max(col,.08);
  O=vec4(col,1);
}</script>

    <script src="script.js"></script>
    <script src="footer-script.js"></script>
    <script type="module">
      import * as THREE from "https://cdn.skypack.dev/three@0.136.0";
      
      console.log("Script loading...");
      
      document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM loaded");
        const particleCanvas = document.getElementById('particleCanvas');
        console.log("Canvas element:", particleCanvas);
        
        if (!particleCanvas) {
          console.error("Canvas not found!");
          return;
        }

        // Very simple test first
        console.log("Creating scene...");
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, particleCanvas.offsetWidth / particleCanvas.offsetHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: particleCanvas, alpha: true });
        
        console.log("Canvas size:", particleCanvas.offsetWidth, "x", particleCanvas.offsetHeight);
        renderer.setSize(particleCanvas.offsetWidth, particleCanvas.offsetHeight);
        camera.position.z = 3;

        // Create a HUGE visible sphere 
        console.log("Creating sphere...");
        const geometry = new THREE.SphereGeometry(2, 16, 16); // Much bigger
        const material = new THREE.MeshBasicMaterial({ 
          color: 0x00ff00, // Bright green
          wireframe: true 
        });
        const sphere = new THREE.Mesh(geometry, material);
        scene.add(sphere);
        console.log("Sphere added, scene children:", scene.children.length);

        // Create HUGE particles
        console.log("Creating particles...");
        const particleGeometry = new THREE.BufferGeometry();
        const particleCount = 500; // Fewer but bigger
        const positions = new Float32Array(particleCount * 3);
        
        for (let i = 0; i < particleCount * 3; i += 3) {
          positions[i] = (Math.random() - 0.5) * 8; // Spread wider
          positions[i + 1] = (Math.random() - 0.5) * 8;
          positions[i + 2] = (Math.random() - 0.5) * 8;
        }
        
        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        const particleMaterial = new THREE.PointsMaterial({ 
          color: 0xff00ff, // Bright magenta
          size: 10 // Much bigger
        });
        const particles = new THREE.Points(particleGeometry, particleMaterial);
        scene.add(particles);
        console.log("Particles added, total scene children:", scene.children.length);

        function animate() {
          requestAnimationFrame(animate);
          
          sphere.rotation.x += 0.01;
          sphere.rotation.y += 0.01;
          
          particles.rotation.y += 0.005;
          
          renderer.render(scene, camera);
        }

        console.log("Starting animation...");
        animate();
        
        // Handle resize
        window.addEventListener('resize', () => {
          const width = particleCanvas.offsetWidth;
          const height = particleCanvas.offsetHeight;
          camera.aspect = width / height;
          camera.updateProjectionMatrix();
          renderer.setSize(width, height);
        });
      });
    </script>


    <!-- Sticky WebGL container - moved outside footer -->
    <div class="sticky-container" id="stickyContainer">
        <div class="webgl-section" id="webglSection">
            <div class="canvas-container" id="canvasContainer">
                <canvas id="space"></canvas>
                <div class="animated-text" id="animatedText">
                    TRUST YOUR EYES<br />NOT THE NOISE
                </div>
            </div>
        </div>
    </div>

    <!-- Particle Skull Section -->
    <div class="particle-section">
        <canvas id="particleCanvas"></canvas>
        <div class="text-wrapper">
            <h2 class="small-text">Let your intuition lead.</h2>
            <h1 class="text-line">
                Answers lie beneath the surface.<br />
                Trust the whispers of your inner voice.
            </h1>
            <h2 class="small-text">Follow your truth.</h2>
        </div>
    </div>

</body>
</html>